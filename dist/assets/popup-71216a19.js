import{r as i,j as u,a as o,c as m,R as g}from"./client-b9aa3ffd.js";const f=(t,e,s)=>{t(!0),chrome.identity.getAuthToken({interactive:!0},r=>{if(chrome.runtime.lastError||!r){console.error("Auth token error:",chrome.runtime.lastError),s("Authentication failed."),t(!1);return}e(!0),t(!1),chrome.storage.sync.get("spreadsheetId",a=>{a.spreadsheetId&&setSpreadsheetId(a.spreadsheetId)})})},b=(t,e,s,r)=>{e(!0),chrome.identity.getAuthToken({interactive:!1},a=>{if(chrome.runtime.lastError||!a){s("Failed to retrieve auth token."),e(!1);return}fetch("https://sheets.googleapis.com/v4/spreadsheets",{method:"POST",headers:{Authorization:"Bearer "+a,"Content-Type":"application/json"},body:JSON.stringify({properties:{title:t},sheets:[{properties:{title:"Sheet1",gridProperties:{frozenRowCount:1}},data:[{startRow:0,startColumn:0,rowData:[{values:[{userEnteredValue:{stringValue:"Company Name"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Job Title"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Deadline"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Apply Link"},userEnteredFormat:{textFormat:{bold:!0}}},{userEnteredValue:{stringValue:"Timestamp"},userEnteredFormat:{textFormat:{bold:!0}}}]}]}]}]})}).then(n=>n.json()).then(n=>{n.spreadsheetId?chrome.storage.sync.set({spreadsheetId:n.spreadsheetId},()=>{r(n.spreadsheetId),e(!1)}):(s("Error creating spreadsheet."),e(!1))}).catch(n=>{s(n.toString()),e(!1)})})},y=t=>{chrome.tabs.query({active:!0,currentWindow:!0},e=>{chrome.tabs.sendMessage(e[0].id,{action:"getJobDetails"},s=>{if(chrome.runtime.lastError||!s){t("Failed to extract job details.");return}chrome.runtime.sendMessage({action:"saveJob",data:s},r=>{r&&r.status==="success"?alert("Job saved successfully!"):t("Failed to save job.")})})})},v=(t,e,s)=>{chrome.identity.getAuthToken({interactive:!1},r=>{r&&fetch("https://accounts.google.com/o/oauth2/revoke?token="+r).then(()=>{chrome.identity.removeCachedAuthToken({token:r},()=>{t(!1),e(null),chrome.storage.sync.remove("spreadsheetId")})}).catch(a=>{s("Failed to logout: "+a.toString())})})};function S(){const[t,e]=i.useState(!1),[s,r]=i.useState(null),[a,n]=i.useState("My Job Applications"),[l,h]=i.useState(!1),[p,c]=i.useState("");return i.useEffect(()=>{chrome.storage.sync.get("spreadsheetId",d=>{d.spreadsheetId&&r(d.spreadsheetId)})},[]),i.useEffect(()=>{chrome.identity.getAuthToken({interactive:!1},d=>{d&&e(!0)})},[]),u("div",{style:{padding:"10px",fontFamily:"Arial, sans-serif"},children:[o("h2",{children:"Job Seeker Extension"}),p&&o("p",{style:{color:"red"},children:p}),l&&o("p",{children:"Loading..."}),!t&&!l&&o("button",{onClick:()=>f(h,e,c),children:"Sign in with Google"}),t&&!s&&!l&&u("div",{children:[o("p",{children:"Create a new spreadsheet to store your job applications."}),u("label",{children:["Spreadsheet Name:"," ",o("input",{type:"text",value:a,onChange:d=>n(d.target.value)})]}),o("button",{onClick:()=>b(a,h,c,r),children:"Create Spreadsheet"})]}),t&&s&&!l&&u("div",{children:[o("button",{onClick:()=>y(c),children:"Save Job"}),o("button",{onClick:()=>v(e,r,c),children:"Logout"})]})]})}const E=m.createRoot(document.getElementById("root"));E.render(o(g.StrictMode,{children:o(S,{})}));
